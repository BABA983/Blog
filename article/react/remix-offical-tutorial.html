<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Remix | BABA&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="BABA 的个人博客">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.390a3189.css" as="style"><link rel="preload" href="/Blog/assets/js/app.1176005e.js" as="script"><link rel="preload" href="/Blog/assets/js/3.daabd2a0.js" as="script"><link rel="preload" href="/Blog/assets/js/1.317b0f87.js" as="script"><link rel="preload" href="/Blog/assets/js/11.668eb78e.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.21422673.js"><link rel="prefetch" href="/Blog/assets/js/12.c37c7bbe.js"><link rel="prefetch" href="/Blog/assets/js/4.e5687d17.js"><link rel="prefetch" href="/Blog/assets/js/5.5dc77b8c.js"><link rel="prefetch" href="/Blog/assets/js/6.7484ccc1.js"><link rel="prefetch" href="/Blog/assets/js/7.6c3652a9.js"><link rel="prefetch" href="/Blog/assets/js/8.bba9ce18.js"><link rel="prefetch" href="/Blog/assets/js/9.28d9a05b.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.390a3189.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>BABA's Blog</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>BABA 的个人博客</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">BABA's Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/" class="nav-link"><i class="undefined"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      BABA
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/SKADaddy" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2137106337768238/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>3</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/Blog/" class="nav-link"><i class="undefined"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      BABA
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/SKADaddy" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2137106337768238/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/Blog/article/vue/composition-api" class="sidebar-heading clickable"><span>Vue</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/article/vue/composition-api.html" class="sidebar-link">composition-api</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Blog/article/react/remix-offical-tutorial" class="sidebar-heading clickable open active"><span>React</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/article/react/remix-offical-tutorial.html" aria-current="page" class="active sidebar-link">remix-offical-tutorial</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2></h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2021
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title">Remix</h1> <div data-v-f875f3fc><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="remix"><a href="#remix" class="header-anchor">#</a> Remix</h2> <h3 id="什么是-remix"><a href="#什么是-remix" class="header-anchor">#</a> 什么是 Remix</h3> <p><a href="https://remix.run/" target="_blank" rel="noopener noreferrer">Remix<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个可以让你专注于用户界面并且重新学习 Web 基础知识来为用户提供快速流畅的用户体验的全栈 Web 框架。</p> <p>它是由 React Router 的团队研发的一个基于 React 的框架，相对于其他的框架，这个框架的一个特点就是专注于 “嵌套路由” 这个概念，允许组件直接与其他页面相连接，简化代码的编写。</p> <p>下面我们通过 Remix 官方文档的教程来搭建一个 Jokes 应用，来了解 Remix 所具有的特性。</p> <h3 id="前置知识"><a href="#前置知识" class="header-anchor">#</a> 前置知识</h3> <ul><li><a href="https://www.typescriptlang.org/docs/handbook/intro.html" target="_blank" rel="noopener noreferrer">TypeScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，这个教程的代码会是基于 TypeScript 来编写的，如果你没了解过 TypeScript 可以去官方的使用手册进行学习，当然你也可以用 JavaScript 来编写。</li> <li><a href="https://beta.reactjs.org/" target="_blank" rel="noopener noreferrer">React<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，Remix 是一款基于 React 的全栈框架，你可能需要了解一部分基础的 React 知识，刚好在最近 React 官方更新了新的文档，相对于以前的基于 class 的写法，新的文档将以 hooks 来做教程。</li></ul> <h3 id="开发环境"><a href="#开发环境" class="header-anchor">#</a> 开发环境</h3> <ul><li><code>Node &gt;= 14</code></li> <li><code>npm &gt;= 7</code></li></ul> <div class="language-zsh extra-class"><pre class="language-text"><code># 你可以检查你的 node 环境是多少，我用的是 16.13.1
node -v
# v16.13.1
npm -v
# 8.1.2
# 可以使用 nvm / window-nvm 来安装 对应的 node 版本
nvm install v16.13.1
# 或者直接安装 stable 版本
nvm install stable
# 然后使用新安装的 node 版本
nvm use v16.13.1
# nvm use stable
</code></pre></div><h3 id="创建-remix-项目"><a href="#创建-remix-项目" class="header-anchor">#</a> 创建 Remix 项目</h3> <p>1、打开你的终端运行下面这行命令</p> <div class="language-zsh extra-class"><pre class="language-text"><code>npx create-remix@latest
</code></pre></div><blockquote><p>执行之后可能会问你是否想安装 <code>create-remix</code> 来执行这个命令。按 Y 确认，它只会暂时安装来执行 setup 脚本</p></blockquote> <p>当安装完成之后，它会问你一些问题</p> <div class="language- extra-class"><pre class="language-text"><code>R E M I X

💿 Welcome to Remix! Let's get you set up with a new project.

? Where would you like to create your app? remix-jokes
? Where do you want to deploy? Choose Remix if you're unsure, it's easy to change deployment targets. Remix
 App Server
? TypeScript or JavaScript? TypeScript
? Do you want me to run `npm install`? Yes
</code></pre></div><p>这里面选择的 Remix App Server 选项，是一个基于 <a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer">Express<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 服务器。</p> <p>当 <code>npm install</code> 完成的时候，我们 <code>cd remix-jokes</code> 进入到目录然后通过宇宙第一 IDE--VSCode 来打开这个目录 <code>code .</code></p> <h3 id="目录结构"><a href="#目录结构" class="header-anchor">#</a> 目录结构</h3> <div class="language- extra-class"><pre class="language-text"><code>remix-jokes
├── README.md
├── app
│   ├── entry.client.tsx
│   ├── entry.server.tsx
│   ├── root.tsx
│   ├── routes
│   │   ├── demos
│   │   │   ├── about
│   │   │   │   ├── index.tsx
│   │   │   │   └── whoa.tsx
│   │   │   ├── about.tsx
│   │   │   ├── actions.tsx
│   │   │   ├── correct.tsx
│   │   │   ├── params
│   │   │   │   ├── $id.tsx
│   │   │   │   └── index.tsx
│   │   │   └── params.tsx
│   │   └── index.tsx
│   └── styles
│       ├── dark.css
│       ├── demos
│       │   └── about.css
│       └── global.css
├── package-lock.json
├── package.json
├── public
│   └── favicon.ico
├── remix.config.js
├── remix.env.d.ts
└── tsconfig.json
</code></pre></div><ul><li><code>app/</code> 这里存放的是你的 Remix 应用的代码，就像 <code>vue-cli</code> / <code>create-react-app</code> 生成项目里面的 <code>src/</code></li> <li><code>app/entry.client.tsx</code> 当应用在浏览器加载完成的时候会运行这个文件里面的 JavaScript 代码，Remix 用这份文件来 <a href="https://reactjs.org/docs/react-dom.html#hydrate" target="_blank" rel="noopener noreferrer">hydrate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> React 组件。hydrate 是什么意思？简单来说就是服务端渲染的时候，服务端返回字符串，浏览器根据这些字符串进行 React 组件的创建，完成初始化的工作，这个过程叫“注水”。</li> <li><code>app/entry.server.tsx</code> 当一个请求发送到服务器的时候，这个文件里面的 JavaScript 代码会第一时间运行。Remix 会帮你加载所有必要的数据，而我们将会负责将响应的数据发送回浏览器。</li> <li><code>app/root.tsx</code> 这份文件是应用的根组件，就像 Vue 的 <code>App.vue</code> ，网页的 <code>html</code> 标签将会在这里渲染。</li> <li><code>app/routes/</code> 这个路径下面将会存放所有和路由相关的模块文件，Remix 会根据这个目录下面的文件名字来创建对应的 URL 路由。</li> <li><code>public/</code> 这里和平常一样存放你项目里的静态资源，例如图片，字体等等。</li> <li><code>remix.config.js</code> Remix 应用对应的配置写在这个文件里面。</li></ul> <p>让我们尝试打包一下文件</p> <div class="language- extra-class"><pre class="language-text"><code>npm run build
</code></pre></div><p>在打包完成之后，当前目录下面会出现下面几个文件夹</p> <ul><li><code>.cache/</code> 这个文件夹里面的内容是 Remix 内部使用的东西</li> <li><code>build/</code> 是服务端的代码</li> <li><code>public/build/</code> 是客户端的代码</li></ul> <p>把这几个路径加入到 .gitignore 文件里面</p> <div class="language- extra-class"><pre class="language-text"><code>/.cache
/build
/public/build
</code></pre></div><p>想要运行打包后的应用执行</p> <div class="language- extra-class"><pre class="language-text"><code>npm start
</code></pre></div><p>打开链接后会看到下面的网页界面</p> <p><img src="https://gitee.com/SKADaddy/pic/raw/master/remix-starter.png" alt="remix-starter"></p> <p>如果你想看看这个 Remix Starter 里面的内容可以点一下对应的链接，但是这些内容在接下来的教程都会讲到。</p> <p><kbd>Ctrl</kbd> + <kbd>C</kbd> 停掉服务，然后删除下面的文件夹</p> <ul><li><code>app/routes</code></li> <li><code>app/styles</code></li></ul> <p>然后把 <code>app/root.tsx</code> 的代码替换掉 <a href="https://remix.run/docs/en/v1/tutorials/jokes#outline" target="_blank" rel="noopener noreferrer">Jokes App<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这个里面的代码，代码我就不复制了，有需要的读者可以复制粘贴到自己的项目。</p> <p>关键的代码是这部分 <code>{process.env.NODE_ENV === &quot;development&quot; ? &lt;LiveReload /&gt; : null}</code> 这个 <code>&lt;LiveReload/&gt;</code> 组件。这个组件会建立一个 WebSocket 来热更新并且自动刷新浏览器。</p> <p>现在你的 <code>app/</code> 目录下面的结构是这样的</p> <div class="language- extra-class"><pre class="language-text"><code>app
├── entry.client.tsx
├── entry.server.tsx
└── root.tsx
</code></pre></div><p>然后运行 <code>npm run dev</code> 这样可以看到整个页面已经跟之前的 Remix Starter 不一样了。</p> <h3 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h3> <p>Remix 的路由有两种方法可以定义</p> <ul><li><p>通过 <a href="https://remix.run/docs/en/v1.0.6/api/conventions#remixconfigjs" target="_blank" rel="noopener noreferrer">remix.config.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来创建路由</p></li> <li><p>另一种 Remix 里更通用的方法是通过在 <code>routes/</code> 文件夹来创建路由</p></li></ul> <h4 id="remix-config-js"><a href="#remix-config-js" class="header-anchor">#</a> remix.config.js</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  appDirectory<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 对应 app 文件夹，你也可以改成 src</span>
  browserBuildDirectory<span class="token operator">:</span> <span class="token string">&quot;public/build&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 打包后客户端代码存放的路径</span>
  devServerPort<span class="token operator">:</span> <span class="token number">8002</span><span class="token punctuation">,</span>
  publicPath<span class="token operator">:</span> <span class="token string">&quot;/build/&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 静态资源存放路径</span>
  serverBuildDirectory<span class="token operator">:</span> <span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 打包后服务端代码存放的路径</span>
  <span class="token function">routes</span><span class="token punctuation">(</span><span class="token parameter">defineRoutes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">defineRoute</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 第一个参数是要匹配的 React Router 路径</span>
      <span class="token comment">// 第二个参数是路由要处理的对应文件</span>
      <span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;/somewhere/cool/*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;catchall.tsx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 如果你要嵌套路由，就在第三个参数传入一个可选的回调方法</span>
      <span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;some/:path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;some/route/file.js&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// - 路径是相对于父路径</span>
      <span class="token comment">// - 文件名仍然相对于 app 路径而不是父路径</span>
      <span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;relative/path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;some/other/file&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 下面这个是我写的 demo 例子</span>
  <span class="token keyword">async</span> <span class="token function">routes</span><span class="token punctuation">(</span><span class="token parameter">defineRoutes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">defineRoutes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;test/:path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;routes/test/index.tsx&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;relative/child1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;routes/test/child.tsx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;relative/child2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;routes/test/child2.tsx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>在 <code>routes/</code> 下面创建 test 文件夹</p> <div class="language- extra-class"><pre class="language-text"><code>test
├── index.tsx
├── child.tsx
└── child2.tsx
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// index.tsx</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Outlet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">TestIndexRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      Test remix.config.js define nested routes </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Outlet</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// child.tsx</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ChildRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Child1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// child2.tsx</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">ChildRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Child2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>http://localhost:3000/test/</code> 加上任意路径都会匹配到 <code>test/index.tsx</code> 这个文件</p> <p><code>http://localhost:3000/test/1234/relative/chlid1</code> 会匹配到 <code>test/child.tsx</code> 这个文件</p> <p><img src="https://gitee.com/SKADaddy/pic/raw/master/image-20211213173334623.png" alt="image-20211213173334623"></p> <p>另一种是官方教程演示的基于文件的路由</p> <p>把文件放到 <code>app/routes/</code> 文件夹里面，这些文件被称为“路由模块”并且应该遵循 Remix 的 <a href="https://remix.run/docs/en/v1.0.6/api/conventions#route-filenames" target="_blank" rel="noopener noreferrer">文件路由命名规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="路由文件命名"><a href="#路由文件命名" class="header-anchor">#</a> 路由文件命名</h4> <ul><li><p><strong><code>app/root.tsx</code></strong> 根路由</p></li> <li><p><strong><code>app/routes/*.{js,ts,jsx,tsx,md,mdx}</code></strong> : 任何在这个文件夹里面的文件都会变成应用的路由，Remix 天然支持这些后缀名的文件</p></li> <li><p><strong><code>app/routes/{folder}/*.tsx</code></strong> : 在文件夹里面的文件会创建嵌套路由</p></li> <li><p><strong><code>app/routes/{folder}</code> 和 <code>app/routes/{folder}.tsx</code>的联动</strong> : 当在 <code>app/routes/</code> 文件夹里面有一个文件的名称和文件夹的名称相同的时候，这个文件就会作为一个 <code>layout</code> 服务于文件夹里面的文件路由。在 <code>{folder}.tsx</code> 里面渲染一个 <code>&lt;Outlet /&gt;</code> ，那么子路由就会渲染替换 <code>&lt;Outlet /&gt;</code>组件渲染出来。往后看会有演示</p></li> <li><p><strong>在文件名里加 <code>.</code></strong> : 在文件名里面加一个 <code>.</code> 会创建一个嵌套路由的路径，但是它的 <code>layout</code> 渲染不会渲染在 <code>{folder.tsx}</code> 的 <code>&lt;Outlet /&gt;</code> 上面。例如 <a href="https://remix.run/docs/en/v1/tutorials/jokes#routes" target="_blank" rel="noopener noreferrer">官方教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <code>jokes.funny.tsx</code> 会创建一个 <code>/jokes/funny</code> 的 URL 路径，它属于 <code>/jokes</code> 的子路由。</p></li> <li><p><strong><code>index.tsx</code></strong> : 当父路径完全匹配的时候就会默认展示。</p></li> <li><p><strong><code>$param</code></strong> : $ 表示 URL 的动态部分，Remix 会帮我们解析并传递到 <code>loader</code> 函数和路由当中。例如 <code>app/routes/users/$userId.tsx</code> 当匹配到浏览器的路径为 <code>/users/1234</code> 的时候，<code>export const loader: LoaderFunction = async ({ params }) =&gt; {}</code> 中的 <code>params.userId === '1234'</code></p></li> <li><p><strong><code>app/routes/files/$.tsx</code></strong> : 会捕获所有 <code>files/*</code> 的路径，我们写个简单的例子解释一下</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// routes/test.tsx</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">TestRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">test</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// routes/test.$.tsx</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LoaderFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> loader<span class="token operator">:</span> <span class="token function-variable function">LoaderFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Test$Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">catch rest route</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 上面的 remix.config.js 里面的 route('test/:path') 需要修改，不然会匹配到所有路径</span>
<span class="token keyword">async</span> <span class="token function">routes</span><span class="token punctuation">(</span><span class="token parameter">defineRoutes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">defineRoutes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// route(&quot;test/:path&quot;, &quot;routes/test/index.tsx&quot;, () =&gt; {</span>
      <span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;test/haha&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;routes/test/index.tsx&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;relative/child1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;routes/test/child.tsx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;relative/child2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;routes/test/child2.tsx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// test/haha 跳转到 routes/test/index.tsx</span>
<span class="token comment">// test/haha1 跳转到 routes/test.$.tsx Loader 函数获取参数 params === { '*': 'haha1' }</span>
<span class="token comment">// test/haha1/123 跳转到 routes/test.$.tsx params === { '*': 'haha1/123' }</span>
<span class="token comment">// test/haha1/123?id=aab 跳转到 routes/test.$.tsx params === { '*': 'haha1/123' }</span>
</code></pre></div></li> <li><p><strong><code>app/routes/__some-layout/some-path.tsx</code></strong> : 文件夹名称如果带有 <code>__</code> 的前缀会创建一个 “Layout Route” ，这个 Layout Route 是 “假” 的，当你的 URL 是 <code>/some-layout</code> 或 <code>/__some-layout</code> 的时候是不会匹配上的，如果你的路径是 <code>/some-path</code> 的时候会匹配上，并且会以 <code>some-latout</code> 为父路由展示在它的 <code>&lt;Outlet /&gt;</code> 上面。</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>├── app
│   ├── routes
│   │   ├── __layout
│   │   │   ├── lmao.tsx
│   │   ├──__layout.tsx
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// __layout.tsx</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Outlet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">LayoutRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      __Layout </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Outlet</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// lmao.tsx</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">LmaoRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">LMAO</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// localhost:3000/__layout 将会是 404</span>
</code></pre></div><p><img src="https://gitee.com/SKADaddy/pic/raw/master/image-20211215100235886.png" alt="image-20211215100235886"></p> <h3 id="样式"><a href="#样式" class="header-anchor">#</a> 样式</h3> <p>通常为了让我们的网页变得更漂亮，我们需要写一些 css 来美化我们的网站。我们添加类似 <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;/path-to-file.css&quot; /&gt;</code> 的标签来加载我们的 css 文件，Remix 也是用同样的方法来加载 css 文件。但是 Remix 更强大的是，把嵌套路由的功能也支持 css 这意味着只有在当前子路由激活的时候才会加载对应的 css，当用户离开当前页面或者说跳转到不同的路由的时候，<code>&lt;link&gt;</code> 标签将会被移除。</p> <p>我们可以在对应的路由文件里面导出 <a href="https://remix.run/docs/en/v1.0.6/api/conventions#links" target="_blank" rel="noopener noreferrer">links<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 函数，复制粘贴 <a href="https://remix.run/docs/en/v1/tutorials/jokes#styling" target="_blank" rel="noopener noreferrer">官网的代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> LinksFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> stylesUrl <span class="token keyword">from</span> <span class="token string">&quot;../styles/index.css&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 关键的代码是这部分，把 links export 出去</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> links<span class="token operator">:</span> <span class="token function-variable function">LinksFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> rel<span class="token operator">:</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">,</span> href<span class="token operator">:</span> stylesUrl <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>但是现在你访问 <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 你会发现样式并没有生效。因为 <code>root.tsx</code> 是渲染所有东西的根结点，包含 <code>&lt;html&gt;</code> <code>&lt;/html&gt;</code> 之间，以为着加载 css 文件的 <code>&lt;link&gt;</code> 标签需要我们自己添加上去，而这个 Remix 已经帮我们封装好了，<code>&lt;Links&gt;</code> 组件，Remix 会帮我们自动把当前路由激活的时候加载对应的 css 文件。引入 <code>Links</code> 组件并且把它放到 <code>&lt;head&gt;</code> 标签里面就可以看到样式生效了。</p> <p><img src="https://gitee.com/SKADaddy/pic/raw/master/jokes-no-styles.png" alt="The jokes page with no background gradient"></p> <p>当你切换到其他路径的时候，你会发现之前 index 页面的 css 样式已经消失了，如果你按 <kbd>F12</kbd> 打开控制台的 element tab，你会发现 <code>&lt;head&gt;</code> 标签里面的 <code>&lt;link&gt;</code> 标签已经被移除了。</p> <blockquote><p>这意味着你在写 css 的时候你不需要担心 css 冲突的问题，这也意味着你的 css 可以长期缓存并且天然的代码分离的</p></blockquote> <p>官网的代码里面比较神奇的是 <code>global-large.css</code> 和 <code>global-medium.css</code> ，点进去你们会发现文件里面并没有用到媒体查询的相关语法，那么它是怎么知道在什么时候应用对应的 css 文件呢？</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">const</span> links<span class="token operator">:</span> <span class="token function-variable function">LinksFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      rel<span class="token operator">:</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">,</span>
      href<span class="token operator">:</span> globalStylesUrl<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      rel<span class="token operator">:</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">,</span>
      href<span class="token operator">:</span> globalMediumStylesUrl<span class="token punctuation">,</span>
      media<span class="token operator">:</span> <span class="token string">&quot;print, (min-width: 640px)&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      rel<span class="token operator">:</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">,</span>
      href<span class="token operator">:</span> globalLargeStylesUrl<span class="token punctuation">,</span>
      media<span class="token operator">:</span> <span class="token string">&quot;screen and (min-width: 1024px)&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>其实很多人应该没有在 <code>&lt;link&gt;</code> 标签使用过媒体查询，<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link" target="_blank" rel="noopener noreferrer">mdn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以查阅到相关的属性。</p> <p><code>LinksFunction</code> 支持两种类型 <code>HtmlLinkDescriptor | PageLinkDescriptor</code></p> <p><code>HtmlLinkDescriptor</code> 就是一种对象形式的 <code>&lt;link&gt;</code> 标签，具体属性可以参考上面的 mdn 链接</p> <p><code>PageLinkDescriptor</code> 这种类型的 LinksFunction 可以让你在用户可能访问某个路径的时候，注意是<strong>可能</strong>，提前加载相应的 JavaScript 模块，loader 数据还有样式到浏览器的缓存里面。</p> <h3 id="数据库"><a href="#数据库" class="header-anchor">#</a> 数据库</h3> <p>真正的开发一个项目的时候，我们一般都需要存储数据，在官网的教程中，我们会用我们自己的 <a href="https://sqlite.org/index.html" target="_blank" rel="noopener noreferrer">SQLite<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 数据库而不是一些第三方提供的持久化解决方案。</p> <h4 id="设置-prisma"><a href="#设置-prisma" class="header-anchor">#</a> 设置 Prisma</h4> <p>如果你用的是 VSCode，那么你可以在插件市场搜索 prisma 来安装他们的插件，这样等会写 prisma 相关语法的时候会有相应提示，非常的方便。Prisma 是一款对象关系映射数据库（Object Relational Mapping），对于不是很熟悉数据库的同学比较友好。</p> <p>现在我们需要安装两个包，这样就可以继续我们的教程了</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev prisma
npm install @prisma/client
</code></pre></div><p>然后初始化</p> <div class="language- extra-class"><pre class="language-text"><code>npx prisma init --datasource-provider sqlite
</code></pre></div><p>接着终端会打印下面的文本，我们就初始化成功了</p> <div class="language- extra-class"><pre class="language-text"><code>✔ Your Prisma schema was created at prisma/schema.prisma
  You can now open it in your favorite editor.

warn You already have a .gitignore. Don't forget to exclude .env to not commit any secret.

Next steps:
1. Set the DATABASE_URL in the .env file to point to your existing database. If your database has no tables yet, read https://pris.ly/d/getting-started
2. Run prisma db pull to turn your database schema into a Prisma schema.
3. Run prisma generate to generate the Prisma Client. You can then start querying your database.

More information in our documentation:
https://pris.ly/d/getting-started
</code></pre></div><p>复制粘贴教程的代码后运行</p> <div class="language- extra-class"><pre class="language-text"><code>npx prisma db push
</code></pre></div><p>我们的数据库文件就会被创建出来 <code>prisma/dev.db</code> ，重要的是他会帮我们生成好对应的 TypeScript 类型，这样我们开发期间调用 prisma 的 API 的时候就会有对应的代码提示。</p> <p>把 <code>prisma/dev.db</code> 和上面终端打印说的 <code>.env</code> 加进 <code>.gitignore</code> 文件里面 。</p> <blockquote><p>如果数据库裂了或者烂了可以直接删掉 dev.db 然后运行 <code>npx prisma db push</code></p></blockquote> <p>然后我们需要添加一些到数据库里面，创建一个 <code>prisma/seed.ts</code> 文件</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PrismaClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@prisma/client&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrismaClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
    <span class="token function">getJokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>joke<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> db<span class="token punctuation">.</span>joke<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token operator">:</span> joke <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getJokes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// shout-out to https://icanhazdadjoke.com/</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;Road worker&quot;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I never wanted to believe that my Dad was stealing from his job as a road worker. But when I got home, all the signs were there.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;Frisbee&quot;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I was wondering why the frisbee was getting bigger, then it hit me.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;Trees&quot;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Why do trees seem suspicious on sunny days? Dunno, they're just a bit shady.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;Skeletons&quot;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Why don't skeletons ride roller coasters? They don't have the stomach for it.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;Hippos&quot;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Why don't you find hippopotamuses hiding in trees? They're really good at it.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;Dinner&quot;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">What did one plate say to the other plate? Dinner is on me!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;Elevator&quot;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">My first time using an elevator was an uplifting experience. The second time let me down.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>安装 <code>esbuilder-register</code></p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev esbuild-register
</code></pre></div><p>然后运行 <code>seed.ts</code></p> <div class="language- extra-class"><pre class="language-text"><code>node --require esbuild-register prisma/seed.ts
</code></pre></div><p>现在我们的数据库里面就会有上面文件写的数据了，运行下面的命令就可以看到对应的表和数据</p> <div class="language- extra-class"><pre class="language-text"><code>npx prisma studio
</code></pre></div><p>但是如果你重置数据库之后就会没有数据，又要重新跑一遍上面的命令，你可以在 <code>package.json</code> 里面添加命令，这样你就不用每次都执行一次了。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// ...</span>
  <span class="token property">&quot;prisma&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;seed&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node --require esbuild-register prisma/seed.ts&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token comment">// ...</span>

</code></pre></div><h4 id="连接数据库"><a href="#连接数据库" class="header-anchor">#</a> 连接数据库</h4> <p>如果你按照上面的步骤来链接数据库</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PrismaClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@prisma/client&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrismaClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样确实可以连接到数据库，但是在我们开发期间，<code>@remix-run/serve</code> 会帮我们重新打包，这样的话每次我们的代码更新，就会和数据库新建一个链接，最终 Prisma 会发出警告 Warning: 10 Prisma Clients are already running.为了解决这个问题我们新建一个文件名为 <code>app/utils/db.server.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PrismaClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@prisma/client&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> db<span class="token operator">:</span> PrismaClient<span class="token punctuation">;</span>

<span class="token keyword">declare</span> global <span class="token punctuation">{</span>
  <span class="token keyword">var</span> __db<span class="token operator">:</span> PrismaClient <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// this is needed because in development we don't want to restart</span>
<span class="token comment">// the server with every change, but we want to make sure we don't</span>
<span class="token comment">// create a new connection to the DB with every change either.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrismaClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db<span class="token punctuation">.</span><span class="token function">$connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>global<span class="token punctuation">.</span>__db<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    global<span class="token punctuation">.</span>__db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrismaClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    global<span class="token punctuation">.</span>__db<span class="token punctuation">.</span><span class="token function">$connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  db <span class="token operator">=</span> global<span class="token punctuation">.</span>__db<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> db <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这里面有一个 Remix 定下的规范，就是带有 <code>.server</code> 的文件最终是不会被打包进客户端的代码。</p> <h4 id="在-loader-中读取数据库的数据"><a href="#在-loader-中读取数据库的数据" class="header-anchor">#</a> 在 loader 中读取数据库的数据</h4> <p>在 Remix 中，每个路由模块都可以通过导出一个 <a href="https://remix.run/docs/en/v1.0.6/api/conventions#loader" target="_blank" rel="noopener noreferrer">loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 函数来获取数据，loader 函数会在服务端被调用。</p> <h5 id="params"><a href="#params" class="header-anchor">#</a> params</h5> <p>路由的参数会传递到 loader 函数当中</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// if the user visits /invoices/123</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> loader<span class="token operator">:</span> <span class="token function-variable function">LoaderFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> params <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  params<span class="token punctuation">.</span>invoiceId<span class="token punctuation">;</span> <span class="token comment">// &quot;123&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="request"><a href="#request" class="header-anchor">#</a> request</h5> <p>这个参数是带有请求信息的 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request" target="_blank" rel="noopener noreferrer">Fetch Request<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实例，可以参考 mdn 文档的属性介绍。一般这个参数是用来读取 headers 里面的内容或者当前 URL 路径</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">let</span> loader<span class="token operator">:</span> <span class="token function-variable function">LoaderFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> request <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// read a cookie</span>
  <span class="token keyword">let</span> cookie <span class="token operator">=</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;Cookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// parse the search params</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> search <span class="token operator">=</span> url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;search&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="context"><a href="#context" class="header-anchor">#</a> context</h5> <p>这个 context 属性你可以在服务端适配器的 <code>getLoadContext()</code> 函数里面获取到，可以填补适配器的 Request/Response API 之间的空白（一个类似后门的属性，一般来说不需要用到）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createRequestHandler <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@remix-run/express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
  <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
  <span class="token function">createRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">getLoadContext</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// this becomes the loader context</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> expressUser<span class="token operator">:</span> req<span class="token punctuation">.</span>user <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后你可以在 loader 中获取到</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">let</span> loader<span class="token operator">:</span> <span class="token function-variable function">LoaderFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> context <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> expressUser <span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>在官网获取 jokes 的例子中，首先先导出一个 loader 函数，然后从数据库中获取数据，并把它以一个对象返回出去，在路由中通过 <code>useLoaderData()</code> 来获取数据最终渲染到页面上。</p> <h3 id="数据提交"><a href="#数据提交" class="header-anchor">#</a> 数据提交</h3> <p>官网的例子中使用了一个原生的 HTML form 表单，相信现在很多人都是使用 Vue 或者 React 作为前端框架来进行开发，有着众多的开源 UI 库以及 axios 这种封装好的请求库，很少人会再用到 form 表单这种比较原始的数据提交方式。但是在 Remix 中，我们不需要安装一些漂亮的 UI 库以及 axios ，我们只需要导出一个 <code>action</code> 函数。</p> <p>像上面提及的 <code>loader</code> 一样，action 是在服务端调用的一个方法，一般用来处理浏览器传递过来的数据或者做一些其他操作。只要不是 GET 请求，这个 action 函数都会被调用，调用时间早于 loader。</p> <p>action 的 API 和 loader 差不多，不同的地方是他们调用的时机不太一样。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ActionFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> db <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;~/utils/db.server&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> action<span class="token operator">:</span> <span class="token function-variable function">ActionFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// we do this type check to be extra sure and to make TypeScript happy</span>
  <span class="token comment">// we'll explore validation next!</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> content <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Form not submitted correctly.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> fields <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> content <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> joke <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>joke<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token operator">:</span> fields <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/jokes/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>joke<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">NewJokeRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Add your own hilarious joke</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            Name: </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            Content: </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            Add
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>像 <code>form.get(&quot;name&quot;)</code> 这种代码大家可能比较陌生，这些都是原生的 Web API，这就是 Remix 这个框架的优点之一，随着逐渐学习，你将会更加了解 Web 相关的东西，而不是新学一个框架，那我这个框架的许多东西都只能局限于这一套生态里面了，学习成本也没有那么的大。</p> <blockquote><p>这里面的 <code>redirect</code> 函数是 Remix 提供的一个简易工具用来创建一个有正确的返回码和请求状态的 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response" target="_blank" rel="noopener noreferrer">Response<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，并将它重定向给用户</p></blockquote> <p>action 的返回值和 loader 一样，可以接受一个可以序列化的对象或者一个 Response，像下面的校验表单就把表单校验的错误在组件中通过 <code>useActionData</code> 函数来获取并渲染到 React 组件上。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ActionFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useActionData<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> json <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> db <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;~/utils/db.server&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">validateJokeContent</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">That joke is too short</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">validateJokeName</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">That joke's name is too short</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">ActionData</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  formError<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  fieldErrors<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    content<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  fields<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">badRequest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token operator">:</span> ActionData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">json</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">400</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> action<span class="token operator">:</span> <span class="token function-variable function">ActionFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> content <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">badRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      formError<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Form not submitted correctly.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> fieldErrors <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token function">validateJokeName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token function">validateJokeContent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fields <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> content <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>fieldErrors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">badRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fieldErrors<span class="token punctuation">,</span> fields <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> joke <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>joke<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token operator">:</span> fields <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/jokes/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>joke<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">NewJokeRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> actionData <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useActionData</span><span class="token generic class-name"><span class="token operator">&lt;</span>ActionData<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Add your own hilarious joke</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            Name:</span><span class="token punctuation">{</span><span class="token string">&quot; &quot;</span><span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
              <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">defaultValue</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>actionData<span class="token operator">?.</span>fields<span class="token operator">?.</span>name<span class="token punctuation">}</span></span>
              <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">aria-invalid</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">Boolean</span><span class="token punctuation">(</span>actionData<span class="token operator">?.</span>fieldErrors<span class="token operator">?.</span>name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">}</span></span>
              <span class="token attr-name">aria-describedby</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
                actionData<span class="token operator">?.</span>fieldErrors<span class="token operator">?.</span>name <span class="token operator">?</span> <span class="token string">&quot;name-error&quot;</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>
              <span class="token punctuation">}</span></span>
            <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span>actionData<span class="token operator">?.</span>fieldErrors<span class="token operator">?.</span>name <span class="token operator">?</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-validation-error<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>alert<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name-error<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
              </span><span class="token punctuation">{</span>actionData<span class="token punctuation">.</span>fieldErrors<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            Content:</span><span class="token punctuation">{</span><span class="token string">&quot; &quot;</span><span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span>
              <span class="token attr-name">defaultValue</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>actionData<span class="token operator">?.</span>fields<span class="token operator">?.</span>content<span class="token punctuation">}</span></span>
              <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">aria-invalid</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
                <span class="token function">Boolean</span><span class="token punctuation">(</span>actionData<span class="token operator">?.</span>fieldErrors<span class="token operator">?.</span>content<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">undefined</span>
              <span class="token punctuation">}</span></span>
              <span class="token attr-name">aria-describedby</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
                actionData<span class="token operator">?.</span>fieldErrors<span class="token operator">?.</span>content <span class="token operator">?</span> <span class="token string">&quot;content-error&quot;</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>
              <span class="token punctuation">}</span></span>
            <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span>actionData<span class="token operator">?.</span>fieldErrors<span class="token operator">?.</span>content <span class="token operator">?</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span>
              <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-validation-error<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>alert<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content-error<span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span><span class="token plain-text">
              </span><span class="token punctuation">{</span>actionData<span class="token punctuation">.</span>fieldErrors<span class="token punctuation">.</span>content<span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            Add
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="权限"><a href="#权限" class="header-anchor">#</a> 权限</h3> <p>官网的例子是使用 <code>bcrypt</code> 来进行加密的 <code>npm i bcrypt</code> 因为是 TypeScript 开发的所以还要安装 <code>npm install --save-dev @types/bcrypt</code></p> <h4 id="登录表单"><a href="#登录表单" class="header-anchor">#</a> 登录表单</h4> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> LinksFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Link<span class="token punctuation">,</span> useSearchParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> stylesUrl <span class="token keyword">from</span> <span class="token string">&quot;../styles/login.css&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> links<span class="token operator">:</span> <span class="token function-variable function">LinksFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> rel<span class="token operator">:</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">,</span> href<span class="token operator">:</span> stylesUrl <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>searchParams<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-light</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Login</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>redirectTo<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;redirectTo&quot;</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token keyword">undefined</span><span class="token punctuation">}</span></span>
          <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sr-only<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Login or Register?</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>radio<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loginType<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>login<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">defaultChecked</span>
              <span class="token punctuation">/&gt;</span></span><span class="token punctuation">{</span><span class="token string">&quot; &quot;</span><span class="token punctuation">}</span><span class="token plain-text">
              Login
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>radio<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loginType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>register<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text"> Register
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username-input<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Username</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username-input<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password-input<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Password</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password-input<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            Submit
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>links<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Home</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/jokes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Jokes</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在实际的业务场景中，会有一些功能是需要用户登录之后才能使用的，当用户想要使用这部分功能的时候，我们就会让用户跳转到登录页，用户登录后需要跳转到之前的页面，而不是首页。在官网的例子中通过 <code>useSearchParams</code> 来获取 URL 上的 <code>redirectTo</code> 参数并将它放到 <code>&lt;form&gt;</code> 标签里面的一个 <code>hidden</code> 的 <code>input</code> 标签。这样在 <code>action</code> 函数里面通过 <code>form.get(&quot;redirectTo&quot;)</code> 获取到需要重定向的路径。</p> <div class="language- extra-class"><pre class="language-text"><code>// example http://localhost:3000/login?redirectTo=%2Fjokes%2Fnew
console.log(useSearchParams())
[
  URLSearchParams { 'redirectTo' =&gt; '/jokes/new' },
  [Function (anonymous)]
]
</code></pre></div><p>我们使用 kody 这个账号登录后终端会打印下面这些信息，这就意味着我们的登录成功了。</p> <div class="language- extra-class"><pre class="language-text"><code>user: {
    id: '161cc267-da50-459b-b6dd-3bfd68820dbc',
    createdAt: '2021-12-05T04:13:26.242Z',
    updatedAt: '2021-12-05T04:13:26.242Z',
    username: 'kody',
    passwordHash: '$2b$10$K7L1OJ45/4Y2nIvhRVpCe.FSmhDdWoXehVzJptJ/op0lSsvqNu/1u'
  }
</code></pre></div><p>官网使用了 Remix 自带的 <code>createCookieSessionStorage</code> 来存储，具体使用可以参考<a href="https://remix.run/docs/en/v1.0.6/api/remix#sessions" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>需要在 <code>.env</code> 文件里面添加 <code>SESSION_SECRET=&quot;my_secret&quot;</code> 值可以随意</p> <p>登录之后通过 <code>redirect</code> 函数跳转并且在函数的第二个参数里设置 Cookie</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createUserSession</span><span class="token punctuation">(</span><span class="token parameter">userId<span class="token operator">:</span> string<span class="token punctuation">,</span> redirectTo<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> storage<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  session<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span>redirectTo<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Set-Cookie&quot;</span><span class="token operator">:</span> <span class="token keyword">await</span> storage<span class="token punctuation">.</span><span class="token function">commitSession</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样后面的每个请求我们都会带上 <code>RJ_session</code>。</p> <h4 id="登出逻辑"><a href="#登出逻辑" class="header-anchor">#</a> 登出逻辑</h4> <p>有登录那么肯定有退出登录，登出需要清楚 session ，用的 <a href="https://remix.run/docs/en/v1.0.6/api/remix#using-sessions" target="_blank" rel="noopener noreferrer"><code>destroySession</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这个方法，具体代码可以看 <a href="https://remix.run/docs/en/v1/tutorials/jokes#build-logout-action" target="_blank" rel="noopener noreferrer">官网的代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>如果是在 action 里面退出登录 Remix 会调用 loader ，但如果是一个链接的话，就不会触发 loader 函数。</p> <h3 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h3> <h4 id="预期外的错误"><a href="#预期外的错误" class="header-anchor">#</a> 预期外的错误</h4> <p>在项目真正上生产后，总是难免会出现一些问题，这些问题可能是我们无法意料到的，例如网络问题啊，服务器挂了啊，同时用了 <code>// @ts-ignore</code> 忽略 TypeScript 的预警。</p> <p>而错误处理，正是 Remix 的一大亮点之一。和 React 的 <a href="https://reactjs.org/docs/error-boundaries.html#gatsby-focus-wrapper" target="_blank" rel="noopener noreferrer">Error Boundary 功能<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类似，Remix 可以让我们导出一个 Error Boundary 组件，在这个组件里面可以处理 loader 和 action 的数据。</p> <p>如果你直接在 root.tsx 导出 Error Boundary 组件的话，你会发现样式都没了，为什么会这样呢？如果你点开 network 选项，你会发现请求发回的页面是下面这样的</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Oops! Something went wrong<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>lol is not defined<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这是因为 root.tsx 需要自己渲染 <code>html</code> 标签还有对应的 <code>&lt;link&gt;</code> 标签，所以我们需要将原本的代码抽离出一个组件</p> <p>把 Error Boundary 组件作为子组件这样样式就会生效了。</p> <p>下面的代码就是返回的 HTML，可以看到 <code>&lt;head&gt;</code> , <code>&lt;link&gt;</code> 和开发环境中支持热更新建立的 websocket</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Remix: So great, it<span class="token entity" title="&amp;#x27;">&amp;#x27;</span>s funny!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/build/_assets/global-3NTXPLP2.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
      <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/build/_assets/global-medium-DRHJR3JT.css<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>print, (min-width: 640px)<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
      <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/build/_assets/global-large-NKTQAWDZ.css<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>screen and (min-width: 1024px)<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/build/_assets/jokes-MGLBGUHK.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Oops! Something went wrong<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>lol is not defined<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">let</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:8002/socket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> event <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;LOG&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;RELOAD&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;💿 Reloading window ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      ws<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Remix dev asset server web socket error:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="https://gitee.com/SKADaddy/pic/raw/master/image-20211216173406714.png" alt="image-20211216173406714"></p> <p>通常来说遇到一些奇奇怪怪的错误网页可能就崩了，或者整个页面展示出对应的错误，Remix 厉害的一点就在于这里，因为是嵌套路由的关系，只是 $jokeId.tsx 无法使用，它的父级页面仍然可以点击跳转到对应的 joke。这样用户体验会更好，不用刷新或者回退页面了。</p> <h5 id="usematches"><a href="#usematches" class="header-anchor">#</a> useMatches</h5> <p>在 Error Boundary 组件中还可以使用 <code>useMatches</code> 来获取匹配的路由和数据，在 $jokeId.tsx 的 loader 中 throw 一个错误</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">const</span> loader<span class="token operator">:</span> <span class="token function-variable function">LoaderFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserId</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;whoops&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- {jokeId: &quot;123&quot;}</span>
  <span class="token keyword">const</span> joke <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>joke<span class="token punctuation">.</span><span class="token function">findUnique</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> params<span class="token punctuation">.</span>jokeId <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// if (!joke) throw new Error(&quot;Joke not found&quot;);</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>joke<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">&quot;What a joke! Not found.&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> data<span class="token operator">:</span> LoaderData <span class="token operator">=</span> <span class="token punctuation">{</span>
    joke<span class="token punctuation">,</span>
    isOwner<span class="token operator">:</span> userId <span class="token operator">===</span> joke<span class="token punctuation">.</span>jokesterId<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 在 ErrorBoundary 中使用 useMatches</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ErrorBoundary</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> error<span class="token operator">:</span> Error <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">useMatches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// throw ahha;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Something went wrong when loading </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>jokeId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!!!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打印出来的结果如下</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    pathname<span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span> jokeId<span class="token operator">:</span> <span class="token string">&quot;88f54075-151a-48ed-9bb2-3b1615f5e53d&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    handle<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    pathname<span class="token operator">:</span> <span class="token string">&quot;/jokes&quot;</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span> jokeId<span class="token operator">:</span> <span class="token string">&quot;88f54075-151a-48ed-9bb2-3b1615f5e53d&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span> jokes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">Array</span><span class="token punctuation">]</span><span class="token punctuation">,</span> user<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    handle<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    pathname<span class="token operator">:</span> <span class="token string">&quot;/jokes/88f54075-151a-48ed-9bb2-3b1615f5e53d&quot;</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span> jokeId<span class="token operator">:</span> <span class="token string">&quot;88f54075-151a-48ed-9bb2-3b1615f5e53d&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    handle<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="处理意料之内的错误"><a href="#处理意料之内的错误" class="header-anchor">#</a> 处理意料之内的错误</h4> <p>有一些错误是我们知道可能会发生的错误，像 &gt;400 &amp;&amp; &lt; 500 是客户端错误，&gt;500 是服务端错误。</p> <p>对于客户端的错误，Remix 提供了一个类似于 Error Boundary 的东西，叫 <a href="https://remix.run/docs/en/v1.0.6/api/conventions#catchboundary" target="_blank" rel="noopener noreferrer"><code>Catch Boundaries</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。和 loader、action 用法差不多，通过 <code>useCatch</code> 获取抛出的 Response 对象，然后根据 Response 进行相关处理。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">const</span> loader<span class="token operator">:</span> <span class="token function-variable function">LoaderFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> userId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserId</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">&quot;Unauthorized&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">401</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">CatchBoundary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> caught <span class="token operator">=</span> <span class="token function">useCatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>caught<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">You must be logged in to create a joke.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/login<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Login</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://gitee.com/SKADaddy/pic/raw/master/image-20211217095424643.png" alt="image-20211217095424643"></p> <p>有新增那么就有删除，但是在 <code>&lt;form&gt;</code> 表单中只有 GET 和 POST，不支持 DELETE ，为了可以让表单在没有 JavaScript 的情况下也能正常使用，官网举了个例子</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_method<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>delete<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样就可以在 action 里面通过 <code>request.formData().get('_method')</code> 知道这个请求事 DELETE 请求</p> <h3 id="seo"><a href="#seo" class="header-anchor">#</a> SEO</h3> <p>现在流行的框架打包出来的应用都是单页应用，众所周知单页应用对于 SEO 不太友好。Remix 为我们提供了一个 <a href="https://remix.run/docs/en/v1.0.6/api/conventions#meta" target="_blank" rel="noopener noreferrer">MetaFunction<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，我们导出一个 meta 函数，就可以在里面读取到 loader 的数据再动态赋值给 <code>&lt;meta&gt;</code> 标签。我们还要像上面加载 CSS 样式一样，从 remix 里面引入 <code>&lt;Meta /&gt;</code> 组件放到 <code>&lt;head&gt;</code> 标签里面。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> LinksFunction<span class="token punctuation">,</span> MetaFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Links<span class="token punctuation">,</span> LiveReload<span class="token punctuation">,</span> Outlet<span class="token punctuation">,</span> useCatch<span class="token punctuation">,</span> Meta <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> globalStylesUrl <span class="token keyword">from</span> <span class="token string">&quot;./styles/global.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> globalMediumStylesUrl <span class="token keyword">from</span> <span class="token string">&quot;./styles/global-medium.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> globalLargeStylesUrl <span class="token keyword">from</span> <span class="token string">&quot;./styles/global-large.css&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> links<span class="token operator">:</span> <span class="token function-variable function">LinksFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      rel<span class="token operator">:</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">,</span>
      href<span class="token operator">:</span> globalStylesUrl<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      rel<span class="token operator">:</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">,</span>
      href<span class="token operator">:</span> globalMediumStylesUrl<span class="token punctuation">,</span>
      media<span class="token operator">:</span> <span class="token string">&quot;print, (min-width: 640px)&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      rel<span class="token operator">:</span> <span class="token string">&quot;stylesheet&quot;</span><span class="token punctuation">,</span>
      href<span class="token operator">:</span> globalLargeStylesUrl<span class="token punctuation">,</span>
      media<span class="token operator">:</span> <span class="token string">&quot;screen and (min-width: 1024px)&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> meta<span class="token operator">:</span> <span class="token function-variable function">MetaFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> description <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Learn Remix and laugh at the same time!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    description<span class="token punctuation">,</span>
    keywords<span class="token operator">:</span> <span class="token string">&quot;Remix,jokes&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;twitter:image&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://remix-jokes.lol/social.png&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;twitter:card&quot;</span><span class="token operator">:</span> <span class="token string">&quot;summary_large_image&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;twitter:creator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@remix_run&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;twitter:site&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@remix_run&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;twitter:title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Remix Jokes&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;twitter:description&quot;</span><span class="token operator">:</span> description<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Document</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  children<span class="token punctuation">,</span>
  title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Remix: So great, it's funny!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  children<span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode<span class="token punctuation">;</span>
  title<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charSet</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Meta</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Links</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token punctuation">{</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;development&quot;</span> <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LiveReload</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Document</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Outlet</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Document</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">CatchBoundary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> caught <span class="token operator">=</span> <span class="token function">useCatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Document</span></span> <span class="token attr-name">title</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>caught<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>caught<span class="token punctuation">.</span>statusText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span>caught<span class="token punctuation">.</span>status<span class="token punctuation">}</span><span class="token plain-text"> </span><span class="token punctuation">{</span>caught<span class="token punctuation">.</span>statusText<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Document</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ErrorBoundary</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> error<span class="token operator">:</span> Error <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Document</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Uh-oh!<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">App Error</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>error<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Document</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="资源路由"><a href="#资源路由" class="header-anchor">#</a> 资源路由</h3> <p>有时候我们想让我们的路由渲染的内容不单单是 HTML 文本，像 pdf、rss 订阅之类的。我们需要把文件名中的 <code>.</code> 加上中括号，官网的 rss 例子就是 <code>jokes[.]rss.tsx</code></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> LoaderFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> db <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;~/utils/db.server&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">escapeCdata</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;]]&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;]]]]&gt;&lt;![CDATA[&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> s
    <span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;amp;&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;lt;&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;gt;&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">'&quot;'</span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;'&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;#039;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> loader<span class="token operator">:</span> <span class="token function-variable function">LoaderFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> jokes <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>joke<span class="token punctuation">.</span><span class="token function">findMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    take<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    orderBy<span class="token operator">:</span> <span class="token punctuation">{</span> createdAt<span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    include<span class="token operator">:</span> <span class="token punctuation">{</span> jokester<span class="token operator">:</span> <span class="token punctuation">{</span> select<span class="token operator">:</span> <span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> host <span class="token operator">=</span>
    request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;X-Forwarded-Host&quot;</span><span class="token punctuation">)</span> <span class="token operator">??</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>host<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Could not determine domain URL.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> protocol <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;http&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;https&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> domain <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>protocol<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> jokesUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domain<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/jokes</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> rssString <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;rss xmlns:blogChannel=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>jokesUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; version=&quot;2.0&quot;&gt;
      &lt;channel&gt;
        &lt;title&gt;Remix Jokes&lt;/title&gt;
        &lt;link&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>jokesUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/link&gt;
        &lt;description&gt;Some funny jokes&lt;/description&gt;
        &lt;language&gt;en-us&lt;/language&gt;
        &lt;generator&gt;Kody the Koala&lt;/generator&gt;
        &lt;ttl&gt;40&lt;/ttl&gt;
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>jokes
          <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>joke<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            &lt;item&gt;
              &lt;title&gt;&lt;![CDATA[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">escapeCdata</span><span class="token punctuation">(</span>joke<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]]&gt;&lt;/title&gt;
              &lt;description&gt;&lt;![CDATA[A funny joke called </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">escapeHtml</span><span class="token punctuation">(</span>
                joke<span class="token punctuation">.</span>name
              <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]]&gt;&lt;/description&gt;
              &lt;author&gt;&lt;![CDATA[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">escapeCdata</span><span class="token punctuation">(</span>
                joke<span class="token punctuation">.</span>jokester<span class="token punctuation">.</span>username
              <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]]&gt;&lt;/author&gt;
              &lt;pubDate&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>joke<span class="token punctuation">.</span>createdAt<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/pubDate&gt;
              &lt;link&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>jokesUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>joke<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/link&gt;
              &lt;guid&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>jokesUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>joke<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/guid&gt;
            &lt;/item&gt;
          </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      &lt;/channel&gt;
    &lt;/rss&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>rssString<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;Cache-Control&quot;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">public, max-age=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, s-maxage=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token string">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/xml&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;Content-Length&quot;</span><span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">byteLength</span><span class="token punctuation">(</span>rssString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这里可能会报错，我们需要把 <code>tsconfig.json</code> 的 <code>compilerOptions</code> 的 <code>&quot;lib&quot;: [&quot;DOM&quot;, &quot;DOM.Iterable&quot;, &quot;ES2019&quot;],</code> 改成这个 <code>&quot;lib&quot;: [&quot;DOM&quot;, &quot;DOM.Iterable&quot;, &quot;ES2021&quot;],</code></p> <p><img src="https://gitee.com/SKADaddy/pic/raw/master/image-20211217114052585.png" alt="image-20211217114052585"></p> <h3 id="javascript"><a href="#javascript" class="header-anchor">#</a> JavaScript</h3> <p>在之前的开发中，细心的同学可能已经发现了，当我们的页面刷新加载的时候，我们的应用是不会加载 js 文件的，</p> <p><img src="https://gitee.com/SKADaddy/pic/raw/master/image-20211217114323527.png" alt="image-20211217114323527"></p> <p>可以看到这里只加载了我的谷歌插件的 js 文件，没有和 Remix 相关的 js 文件。这也是 Remix 的一大亮点之一！！！可能有人会说，现在都什么年代了，加载一下 JavaScript 又不会怎么样。这也能算优点？但是毕竟每个人的情况不一样，网速有快有慢，慢的可能需要等待你的应用加载完 JavaScript 才能使用相应的功能，但是如果用户无需加载 JS 文件就能够使用正常的功能，那么对于用户的体验来说是一种很大的提升。</p> <p>但是这也是有缺点的，当我们点击左边的 joke 获取对应的数据时，你会发现我们的网页是会刷新的，虽然热更新的速度非常快，但它还是刷新页面了。</p> <p>除了上面这点，有些情况还是需要 JS 文件才能运行的，例如一些 UI 展示还是需要 JS 来判断什么时候展示什么样的 UI。</p> <p>让 Remix 加载 JS 文件我们可以从 remix 包里面引入 <code>&lt;Scripts /&gt;</code> 组件</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Links<span class="token punctuation">,</span> LiveReload<span class="token punctuation">,</span> Outlet<span class="token punctuation">,</span> useCatch<span class="token punctuation">,</span> Meta<span class="token punctuation">,</span> Scripts <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;remix&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token keyword">function</span> <span class="token function">Document</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  children<span class="token punctuation">,</span>
  title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Remix: So great, it's funny!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  children<span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode<span class="token punctuation">;</span>
  title<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charSet</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Meta</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Links</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Scripts</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;development&quot;</span> <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LiveReload</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Document</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Outlet</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Document</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在我们就可以看到加载了的 JS 文件，而且点击 joke 获取笑话的时候页面也不会刷新了</p> <p><img src="https://gitee.com/SKADaddy/pic/raw/master/image-20211217115621197.png" alt="image-20211217115621197"></p> <p>而且你现在 <code>ErrorBoundary</code> 组件用 <code>console.error</code> 打印错误的时候，它不仅仅会在服务端打印出，在浏览器也可以打印出错误的信息。</p> <p><img src="https://gitee.com/SKADaddy/pic/raw/master/server-side-error-in-browser.png" alt="Browser console showing the log of a server-side error"></p> <h3 id="form"><a href="#form" class="header-anchor">#</a> Form</h3> <p>HTML 的原生标签 <code>&lt;form&gt;</code> 在提交后会刷新页面，所以 Remix 为我们提供了加强版的 <a href="https://remix.run/docs/en/v1.0.6/api/remix#form" target="_blank" rel="noopener noreferrer"><code>&lt;Form /&gt;</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 组件，在 JavaScript 没有加载完成的时候，它是原生的 <code>&lt;form&gt;</code> 标签，当 JS 加载完成之后，它就变成增强版，会发送 <code>fetch</code> 请求，默认 <code>preventDefault</code> 这样就不会发请求刷新页面了。</p> <h3 id="prefetch"><a href="#prefetch" class="header-anchor">#</a> Prefetch</h3> <p>如果一个用户的鼠标移动到一个链接上面，则表明这个用户可能想跳转到那个页面，所以我们可以 prefetch 对应的页面，这样用户点击跳转的时候会觉得很快。在 Remix 要实现这个功能很简单只需要在 <code>&lt;Link /&gt;</code> 组件上加一个属性 <code>prefetch</code></p> <p>从 Remix 的 TypeScript 文件中可以看到这个属性有三个值可以填</p> <p><img src="https://gitee.com/SKADaddy/pic/raw/master/image-20211217154146528.png" alt="image-20211217154146528"></p> <p>当你的鼠标移上去的时候你会发现 network 里面成功 prefetch 对应的 JS 文件</p> <p><img src="https://gitee.com/SKADaddy/pic/raw/master/image-20211217153534969.png" alt="image-20211217153534969"></p> <h3 id="ui-交互优化"><a href="#ui-交互优化" class="header-anchor">#</a> UI 交互优化</h3> <p>官网的例子中还讲述了如何通过 <code>useTransition</code> 来优化用户点击提交数据后 UI 界面的互动展示，<a href="https://remix.run/docs/en/v1/tutorials/jokes#optimistic-ui" target="_blank" rel="noopener noreferrer">详情<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以直接点进去看，这里就不展开描述了。</p> <h3 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h3> <p>官网教程是用的 <a href="https://fly.io/" target="_blank" rel="noopener noreferrer">fly.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来部署这个项目的，感兴趣的朋友可以注册个账号试一试</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>Remix 作为一款全栈框架有着以下几个优点</p> <ul><li>天然的嵌套路由优势</li> <li>各种错误的边界处理</li> <li>靠近原生 WEB ，不需要投入过多的学习成本，当然还是要学习 React 的基础知识的</li> <li>SEO 友好</li> <li>自动拆分代码，无需繁琐的配置</li></ul> <p>Remix 毕竟才刚出 1.0 版本没多久，生态、教程之类的资源还比较少，但是相信在 Remix 在关闭收费订阅模式作为开源项目能够拿到 300 万美元的投资，不少人对这个框架还是对有信心的，毕竟服务端渲染的 SEO 问题，很多人都会搭配 Next 或 Nuxt 来进行开发。Remix 作为全栈框架也可以提供服务端渲染，并且是一体的，相信在未来会有更多人选择 Remix 框架。</p> <p>从前端到全栈，我想这是很多人都有想过的问题，要做到全栈，很多时候就意味着需要重新学习一门语言，这成为了很多人的拦路虎。</p> <p>Remix 解决了语言的问题，将会是许多前端开发人员迈向全栈的一种尝试，相信前端的未来发展绝不仅于此。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/Blog/article/vue/composition-api.html" class="prev">
            composition-api
          </a></span> <!----></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#remix" class="sidebar-link reco-side-remix" data-v-cb1513f6>Remix</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#什么是-remix" class="sidebar-link reco-side-什么是-remix" data-v-cb1513f6>什么是 Remix</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#前置知识" class="sidebar-link reco-side-前置知识" data-v-cb1513f6>前置知识</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#开发环境" class="sidebar-link reco-side-开发环境" data-v-cb1513f6>开发环境</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#创建-remix-项目" class="sidebar-link reco-side-创建-remix-项目" data-v-cb1513f6>创建 Remix 项目</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#目录结构" class="sidebar-link reco-side-目录结构" data-v-cb1513f6>目录结构</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#路由" class="sidebar-link reco-side-路由" data-v-cb1513f6>路由</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#样式" class="sidebar-link reco-side-样式" data-v-cb1513f6>样式</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#数据库" class="sidebar-link reco-side-数据库" data-v-cb1513f6>数据库</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#数据提交" class="sidebar-link reco-side-数据提交" data-v-cb1513f6>数据提交</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#权限" class="sidebar-link reco-side-权限" data-v-cb1513f6>权限</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#错误处理" class="sidebar-link reco-side-错误处理" data-v-cb1513f6>错误处理</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#seo" class="sidebar-link reco-side-seo" data-v-cb1513f6>SEO</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#资源路由" class="sidebar-link reco-side-资源路由" data-v-cb1513f6>资源路由</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#javascript" class="sidebar-link reco-side-javascript" data-v-cb1513f6>JavaScript</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#form" class="sidebar-link reco-side-form" data-v-cb1513f6>Form</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#prefetch" class="sidebar-link reco-side-prefetch" data-v-cb1513f6>Prefetch</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#ui-交互优化" class="sidebar-link reco-side-ui-交互优化" data-v-cb1513f6>UI 交互优化</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#部署" class="sidebar-link reco-side-部署" data-v-cb1513f6>部署</a></li><li class="level-3" data-v-cb1513f6><a href="/Blog/article/react/remix-offical-tutorial.html#总结" class="sidebar-link reco-side-总结" data-v-cb1513f6>总结</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/Blog/assets/js/app.1176005e.js" defer></script><script src="/Blog/assets/js/3.daabd2a0.js" defer></script><script src="/Blog/assets/js/1.317b0f87.js" defer></script><script src="/Blog/assets/js/11.668eb78e.js" defer></script>
  </body>
</html>
