(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{554:function(t,s,a){"use strict";a.r(s);var n=a(12),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"在-vue2-项目中使用-vue-composition-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-vue2-项目中使用-vue-composition-api"}},[t._v("#")]),t._v(" 在 Vue2 项目中使用@vue/composition-api")]),t._v(" "),a("h2",{attrs:{id:"为什么要使用-composition-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要使用-composition-api"}},[t._v("#")]),t._v(" 为什么要使用 composition-api")]),t._v(" "),a("p",[t._v("可能很多人会问，为什么一定要在"),a("code",[t._v("vue2")]),t._v("上使用"),a("code",[t._v("composition-api")]),t._v("呢？直接把项目升级到"),a("code",[t._v("vue3")]),t._v("不就好了吗？")]),t._v(" "),a("ol",[a("li",[t._v("生态问题，许多开源的库目前正在逐步升级到 vue3")]),t._v(" "),a("li",[t._v("项目如果非常庞大那么做起"),a("code",[t._v("vue2")]),t._v(" -> "),a("code",[t._v("vue3")]),t._v("的迁移还是非常麻烦的。")]),t._v(" "),a("li",[t._v("在"),a("code",[t._v("vue2")]),t._v("使用"),a("code",[t._v("composition-api")]),t._v("不会影响到现有的功能，并且在未来如果要升级到"),a("code",[t._v("vue3")]),t._v("那么只需要把引入的包从"),a("code",[t._v("@vue/composition-api")]),t._v("改为"),a("code",[t._v("vue")]),t._v("就可以了")])]),t._v(" "),a("h2",{attrs:{id:"安装-vue-composition-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-vue-composition-api"}},[t._v("#")]),t._v(" 安装@vue/composition-api")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/vuejs/composition-api",target:"_blank",rel:"noopener noreferrer"}},[t._v("@vue/composition-api"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" @vue/composition-api\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" @vue/composition-api\n")])])]),a("p",[t._v("光下载完可不行，我们还需要把他当作插件一样来注册他"),a("code",[t._v("Vue.use()")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" VueCompositionAPI "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@vue/composition-api"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nVue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VueCompositionAPI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("然后在"),a("code",[t._v(".vue")]),t._v("组件里面引入，就可以使用部分"),a("code",[t._v("vue3")]),t._v("的功能啦")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// use the APIs import { ref, reactive } from '@vue/composition-api' // 💡 When")]),t._v("\nyou migrate to Vue "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" just replacing "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("@vue/composition-api")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" to "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("vue")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" and your\ncode should just work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reactive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),t._v("\n")])])]),a("h2",{attrs:{id:"typescript-支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#typescript-支持"}},[t._v("#")]),t._v(" TypeScript 支持")]),t._v(" "),a("p",[t._v("可能有的同学会问，我现在用的"),a("code",[t._v("Vue2")]),t._v("项目引入了"),a("code",[t._v("vue-property-decorator")]),t._v("和"),a("code",[t._v("vue-class-component")]),t._v("来支持"),a("code",[t._v("Typescript")]),t._v("的写法，如果我改为"),a("code",[t._v("composition-api")]),t._v("的写法那我岂不是又只能写"),a("code",[t._v("Javascript")]),t._v("了？之前辛辛苦苦学的"),a("code",[t._v("TypeScript")]),t._v("岂不是白学了。")]),t._v(" "),a("p",[t._v("放心朋友，虽然"),a("code",[t._v("Vue 2.6")]),t._v("以前的版本"),a("code",[t._v("Vue")]),t._v("是用的"),a("code",[t._v("flow")]),t._v("来进行类型检查，但是在"),a("code",[t._v("Vue3")]),t._v("以及"),a("code",[t._v("Vue conf")]),t._v("上所说的在 Q3 发布的"),a("code",[t._v("Vue2.7")]),t._v("都是使用的"),a("code",[t._v("TypeScript")]),t._v("来进行类型检查，所有"),a("code",[t._v("composition-api")]),t._v("也是支持"),a("code",[t._v("TypeScript")]),t._v("的")]),t._v(" "),a("p",[t._v("但是需要"),a("code",[t._v("TypeScript")]),t._v("的版本"),a("code",[t._v(">3.5.1")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" defineComponent "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@vue/composition-api'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n只需要把代码写在defineComponent里面，ts的静态检查就会工作 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// type inference enabled props:{} setup(props,ctx){} data(){}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("created")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mounted")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"浏览器支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器支持"}},[t._v("#")]),t._v(" 浏览器支持")]),t._v(" "),a("p",[t._v("与"),a("code",[t._v("Vue3")]),t._v("一样，"),a("code",[t._v("composition-api")]),t._v("支持所有现代浏览器以及 IE11+，如果需要支持低版本的 IE 你应该安装"),a("code",[t._v("WeakMap")]),t._v("的 polyfill 例如"),a("code",[t._v("core-js")])]),t._v(" "),a("h2",{attrs:{id:"composition-api-vs-options-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#composition-api-vs-options-api"}},[t._v("#")]),t._v(" composition-api VS options api")]),t._v(" "),a("p",[t._v("​ 像下面的代码就是"),a("code",[t._v("Vue2")]),t._v("的 options api,当我们的代码到达一定量的时候这种结构就会很难以维护，这时候就有人会说，我们可以使用"),a("code",[t._v("mixin")]),t._v("把公共逻辑抽取出来。")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("scirpt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    components"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    mixins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("xxxMixin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    props"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// some reactive data")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("created")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    methods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("scirpt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("​ 但我想很多人都会遇到过这种问题：在"),a("code",[t._v("<template>")]),t._v("或者"),a("code",[t._v("methods")]),t._v("选项中找某个方法或者变量的时候找遍整个"),a("code",[t._v(".vue")]),t._v("文件都找不到，直到看到"),a("code",[t._v("script")]),t._v("标签里面看到个"),a("code",[t._v("mixins")]),t._v("选项才恍然大悟，哦，原来是混入进来的，然后如果"),a("code",[t._v("mixins")]),t._v("里面有多个"),a("code",[t._v("mixin")]),t._v("又要去每个文件里面去找到对应的变量")]),t._v(" "),a("p",[t._v("​ 除了上面的这种情况，如果我们需要往这个"),a("code",[t._v(".vue")]),t._v("文件添加新的功能，那么我们很大概率需要进行以下几个步骤")]),t._v(" "),a("p",[t._v("​ 1⃣️ 在"),a("code",[t._v("data")]),t._v("选项中定义对应的变量，这样才可以使这个变量变为响应式的")]),t._v(" "),a("p",[t._v("​ 2⃣️ 在"),a("code",[t._v("methods")]),t._v("选项中新增对应的函数方法")]),t._v(" "),a("p",[t._v("​ 或者我们也可以把新功能抽成"),a("code",[t._v("mixin")]),t._v("但是这样我们可能会遇到之前所说的问题，当然这些问题我们也可以通过一些方法避免，例如定义的变量前缀带一个"),a("code",[t._v("Mixin_")]),t._v("例如"),a("code",[t._v("Mixin_xxx")]),t._v("这样在用这个变量的时候我们就会知道，哦，这是个"),a("code",[t._v("mixin")]),t._v("，而不是找遍所有文件之后才发现他是个"),a("code",[t._v("mixin")])]),t._v(" "),a("p",[t._v("​ 下面我就用一张经典老图来展示出"),a("code",[t._v("composition-api")]),t._v("他的优势")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/62783026-810e6180-ba89-11e9-8774-e7771c8095d6.png",alt:"img"}})]),t._v(" "),a("p",[t._v("可能有人看到这张图的时候会很困惑，就会说”诶小伙子，我看你这两个对比下来，代码量也没多大变化啊还是这么长啊看着“。")]),t._v(" "),a("p",[t._v("但是实际上我们可以根据颜色把右边的代码看成这样")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 相对于mixin是不是更加的清晰")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("login "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useLogin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" pageNum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pageSize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getList "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("usePagination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("XXX")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useXxx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("为什么可以看成这样呢？")]),t._v(" "),a("p",[t._v("这时候就需要先引入"),a("code",[t._v("ref")]),t._v("以及"),a("code",[t._v("reactive")]),t._v("这两个概念了")]),t._v(" "),a("h3",{attrs:{id:"ref、reactive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ref、reactive"}},[t._v("#")]),t._v(" ref、reactive")]),t._v(" "),a("p",[t._v("在 options api 中如果我们要让变量是 reactive 的，我们需要把变量都定义在"),a("code",[t._v("data()")]),t._v("中，但是在"),a("code",[t._v("setup()")]),t._v("中我们可以使用"),a("code",[t._v("ref")]),t._v("或者"),a("code",[t._v("reactive")]),t._v("在"),a("code",[t._v("setup")]),t._v("这个函数体的任意地方使得该变量转换成 reactive 的变量")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我们可以先在这里定义一个变量")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dataList "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  dataList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 假设我们的代码很长，然后如果有某些条件，我们可以紧接着再定义一个变量，而不需要再回到data()里面重新定义一个新变量使得这个变量reactive")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当然，如果你习惯了options api或者说，你们公司自己的规范就是希望变量都定义在同一个区域内。那么你也可以这么写")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reactive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    dataList"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    message"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataList "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("细心的朋友可能已经发现，"),a("code",[t._v("ref")]),t._v("和"),a("code",[t._v("reactive")]),t._v("我们对他们俩进行数据操作的时候表现的有那么点不同，为什么"),a("code",[t._v("ref")]),t._v("定义的就需要用"),a("code",[t._v(".value")]),t._v("才能去进行访问呢？这个时候就需要看到"),a("a",{attrs:{href:"https://v3.vuejs.org/guide/composition-api-introduction.html#reactive-variables-with-ref",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1),t._v("中对于"),a("code",[t._v("ref")]),t._v("以及"),a("code",[t._v("reactive")]),t._v("的介绍了")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("Vue3")]),t._v("中你可以通过"),a("code",[t._v("ref")]),t._v("函数将任意的变量变成 reactive 的，就像在"),a("code",[t._v("Vue2")]),t._v("的"),a("code",[t._v("data()")]),t._v("中定义一样")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ref "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" counter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("code",[t._v("ref")]),t._v("接受一个参数，并且返回一个对象，这个对象包裹着一个名为"),a("code",[t._v("value")]),t._v("的属性，这样我们就可以通过这个"),a("code",[t._v("value")]),t._v("来访问这个属性或者更改它了")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ref "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" counter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("counter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// { value: 0 }")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("counter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0")]),t._v("\n\ncounter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("counter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n")])])]),a("p",[t._v("那么为什么这个"),a("code",[t._v("ref")]),t._v("要做的这么复杂呢，还要把数据包一层？下面这张官网的经典动态图，生动的解释了为神魔要这么做")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/pass-by-reference-vs-pass-by-value-animation-20210525102353835.gif",alt:"Pass by reference vs pass by value"}})]),t._v(" "),a("p",[t._v("这是为了在"),a("code",[t._v("JavaScript")]),t._v("中保持数据不同类型的行为一致性。因为在"),a("code",[t._v("JavaScript")]),t._v("中，基础类型像"),a("code",[t._v("Number")]),t._v("、"),a("code",[t._v("String")]),t._v("是通过值传递的，而不是引用传递。")]),t._v(" "),a("p",[t._v("在我们对这个变量进行一层包装后把它变为一个对象，那么我们就可以在整个 App 里面安全的传递它而不用担心在传递的过程中，在某些地方丢失它的响应性了。")]),t._v(" "),a("p",[t._v("换句话说，"),a("code",[t._v("ref")]),t._v("对于我们的变量所做的，就是创建了一个响应式的引用，在使用"),a("code",[t._v("composition-api")]),t._v("的过程中，这个"),a("code",[t._v("引用")]),t._v("的概念将会经常出现。")]),t._v(" "),a("p",[t._v("这时候回到我们上面的代码，")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// index.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 相对于mixin是不是更加的清晰")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" login "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useLogin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" pageNum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pageSize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getList "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("usePagination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("XXX")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useXxx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("当我们把公共代码抽离出来，再运用这些"),a("code",[t._v("'mixin'")]),t._v("的时候，相对于"),a("code",[t._v("mixin")]),t._v("是不是更加的清晰")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// usePagination.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("usePagination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pageNum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pageSize "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" total "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getList")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// some logic...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    pageNum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    pageSize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    getList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这里我们就是靠的"),a("code",[t._v("ref")]),t._v("创建的"),a("code",[t._v("引用")]),t._v("来贯穿我们的组合式 API。")]),t._v(" "),a("p",[t._v("需要注意的是，如果想要在"),a("code",[t._v("template")]),t._v("中使用变量就需要把它们"),a("code",[t._v("return")]),t._v("出去，而且由"),a("code",[t._v("ref")]),t._v("创建的变量也不需要使用"),a("code",[t._v(".value")]),t._v("来访问，会自动 unwrap")]),t._v(" "),a("h3",{attrs:{id:"setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setup"}},[t._v("#")]),t._v(" Setup()")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("setup")]),t._v("中我们会有两个参数供我们使用，一个是"),a("code",[t._v("props")]),t._v("，另一个是"),a("code",[t._v("context")]),t._v("，下面我们来看看这两个参数到底是什么")]),t._v(" "),a("h4",{attrs:{id:"props"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#props"}},[t._v("#")]),t._v(" Props")]),t._v(" "),a("p",[a("code",[t._v("props")]),t._v("其实就是我们父组件在传递值给我们子组件的时候的 prop 值，在"),a("code",[t._v("setup")]),t._v("中我们需要通过这个参数来调用它们，因为在"),a("code",[t._v("setup")]),t._v("中，"),a("code",[t._v("this")]),t._v("是无法使用的，"),a("code",[t._v("setup")]),t._v("中的"),a("code",[t._v("this")]),t._v("不是直接指向"),a("code",[t._v("Vue")]),t._v("实例")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  props"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    searchTemplate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      required"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你可以直接这么访问")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("searchTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("当你直接使用"),a("code",[t._v("props.xxx")]),t._v("访问的时候，这个是响应式的，当父组件的数据变化时，这里也会跟着变化，但是当你想使用"),a("code",[t._v("ES6")]),t._v("的解构的时候，这个属性就会失去响应性了，如果你想解构的方式去使用 props 里面传过来的值，那么你应该使用"),a("code",[t._v("toRefs")]),t._v("需要注意的是通过==.value==来进行访问")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  props"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    searchTemplate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      required"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你可以直接这么访问")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("searchTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ❌")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" searchTemplate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ✅")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" searchTemplate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toRefs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("当你这个 prop 不是"),a("code",[t._v("required")]),t._v("的时候，它是不确定的，那么你用"),a("code",[t._v("toRefs")]),t._v("可能获取不到，那么他就不会创建一个"),a("code",[t._v("ref")]),t._v("，这个时候你要使用"),a("code",[t._v("toRef")]),t._v("了")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  props"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    searchTemplate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      required"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    total"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" total "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"total"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[t._v("#")]),t._v(" Context")]),t._v(" "),a("p",[a("code",[t._v("setup")]),t._v("中的第二个参数是"),a("code",[t._v("context")]),t._v("，在"),a("code",[t._v("Vue3")]),t._v("的官方文档中的介绍是一个普通的"),a("code",[t._v("JavaScript")]),t._v("对象，会暴露出三个组件属性，它们分别是"),a("code",[t._v("attrs")]),t._v("、"),a("code",[t._v("slots")]),t._v("、"),a("code",[t._v("emit")]),t._v("，但是其实在"),a("code",[t._v("Vue2")]),t._v("中使用"),a("code",[t._v("setup")]),t._v("的话，这个"),a("code",[t._v("context")]),t._v("对象里面，不仅仅只有这三个属性。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/image-20210527095433991.png",alt:"image-20210527095433991"}})]),t._v(" "),a("p",[t._v("我们可以看到除了上面介绍的三个属性以外，还有几个画了删除线的属性，"),a("s",[t._v("parent")]),t._v("、"),a("s",[t._v("root")]),t._v("、"),a("s",[t._v("listeners")]),t._v("、"),a("s",[t._v("refs")]),t._v("当我们鼠标移上去的时候就会看到提示，说这是一个废弃属性，这个属性在"),a("code",[t._v("Vue3")]),t._v("是用不了的，当然，如果你要用它也不是不行，除非你这个项目以后不想升级到"),a("code",[t._v("Vue3")]),t._v("，否则我的建议是遵循官方的做法，不要使用这些已经被废弃了的属性。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/image-20210527095736698.png",alt:"image-20210527095736698"}})]),t._v(" "),a("p",[t._v("上面这三个属性你也可以直接使用解构来获取它们，毕竟"),a("code",[t._v("context")]),t._v("只是一个普通的对象")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" attrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" slots"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" emit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在"),a("code",[t._v("setup")]),t._v("被执行的时候，组件实例是还没被创建的，"),a("code",[t._v("setup")]),t._v("是介于"),a("code",[t._v("beforeCreate")]),t._v("和"),a("code",[t._v("created")]),t._v("之间的，换句话说你只能在"),a("code",[t._v("setup")]),t._v("中访问以下属性")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("props")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("attrs")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("slots")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("emit")])])])]),t._v(" "),a("p",[t._v("换句话说，你不能够访问"),a("code",[t._v("data")]),t._v("、"),a("code",[t._v("computed")]),t._v("、"),a("code",[t._v("methods")]),t._v(",而且"),a("code",[t._v("setup")]),t._v("里面没有"),a("code",[t._v("this")]),t._v("，你想访问也访问不到～～")]),t._v(" "),a("h4",{attrs:{id:"this"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#this"}},[t._v("#")]),t._v(" this")]),t._v(" "),a("p",[t._v("那么可能就会有人问到，诶那既然在"),a("code",[t._v("setup")]),t._v("中都拿不到"),a("code",[t._v("this")]),t._v("那我绑定在"),a("code",[t._v("prototype")]),t._v("上的方法要怎么调用啊，不慌，我们来翻阅一下"),a("a",{attrs:{href:"https://v3.vuejs.org/api/application-config.html#globalproperties",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1),t._v("发现了这么个东东")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/image-20210527102130075.png",alt:"image-20210527102130075"}})]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("Vue3")]),t._v("中已经是不推荐我们将方法直接绑定在"),a("code",[t._v("prototype")]),t._v("上面了，而是换了个 api，看到这 ❤️ 都凉了半截，那组合式 API 岂不是与我无缘了，别慌，我们还有另一个"),a("a",{attrs:{href:"https://v3.vuejs.org/api/composition-api.html#getcurrentinstance",target:"_blank",rel:"noopener noreferrer"}},[t._v("getCurrentInstance"),a("OutboundLink")],1),t._v("，这个 API 可以让我们访问到内部的组件实例，让我们"),a("code",[t._v("console.log")]),t._v("👀 一下里面都有啥")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/image-20210527104912561.png",alt:"image-20210527104912561"}})]),t._v(" "),a("p",[t._v("嚯，好家伙，东西可真不少啊，我们点进这个"),a("code",[t._v("proxy")]),t._v("看看")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/image-20210527105235814.png",alt:"image-20210527105235814"}})]),t._v(" "),a("p",[t._v("之前"),a("code",[t._v("context")]),t._v("里面的各个属性，都出现在了这个"),a("code",[t._v("proxy")]),t._v("里面，不管是废弃的还是可以使用的，可能有的同学会问，但是我并没有看到那些"),a("code",[t._v("element")]),t._v("相关的方法啊，什么"),a("code",[t._v("$message")]),t._v("、"),a("code",[t._v("$confirm")]),t._v("，我们都知道，原型链是一级一级往上找的，这里没找到，我们往它的父级在看看")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/image-20210527105914780.png",alt:"image-20210527105914780"}})]),t._v(" "),a("p",[t._v("不但看到"),a("code",[t._v("element")]),t._v("的方法，还看到了"),a("code",[t._v("Vue")]),t._v("自己的一些 api 方法，那具体我们可以如何使用这个"),a("code",[t._v("proxy")]),t._v("呢")]),t._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ComponentInternalInstance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  defineComponent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  getCurrentInstance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@vue/composition-api"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" proxy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCurrentInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("我们可以直接把它解构出来，但是这样的话，在"),a("code",[t._v("TypeScript")]),t._v("中会有一个报错")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/image-20210527110244131.png",alt:"image-20210527110244131"}})]),t._v(" "),a("p",[t._v("我的办法是用类型断言 "),a("code",[t._v("const { proxy } = getCurrentInstance() as ComponentInternalInstance")]),t._v("，有的人可能会说那我"),a("code",[t._v("proxy.$message")]),t._v("、"),a("code",[t._v("proxy.$router.push")]),t._v("这样写多丑陋啊，我还是习惯用"),a("code",[t._v("this")]),t._v("。"),a("s",[t._v("那我推荐你直接用回你的 options api 吧")]),t._v("，你可以对这个"),a("code",[t._v("proxy")]),t._v("重命名，例如"),a("code",[t._v("const { proxy:_this } = getCurrentInstance() as ComponentInternalInstance")]),t._v("这样，看着和原来也没多大区别是不是？")]),t._v(" "),a("h3",{attrs:{id:"lifecycle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lifecycle"}},[t._v("#")]),t._v(" LifeCycle")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("setup")]),t._v("中的生命周期与传统的"),a("code",[t._v("options api")]),t._v("有那么点不一样，"),a("code",[t._v("setup")]),t._v("中是没有"),a("code",[t._v("created")]),t._v("和"),a("code",[t._v("beforeCreate")]),t._v("的，在"),a("code",[t._v("setup")]),t._v("中你直接打印一段话在控制台你会发现，setup 是在它们俩之间执行的")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/SKADaddy/pic/raw/master/image-20210527111252662.png",alt:"image-20210527111252662"}})]),t._v(" "),a("p",[t._v("而对于其他生命周期的钩子函数，"),a("code",[t._v("vue")]),t._v("也对它们进行了改名，更加的语义化了")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Options API")]),t._v(" "),a("th",[t._v("Hook inside "),a("code",[t._v("setup")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("beforeCreate")])]),t._v(" "),a("td",[t._v("Not needed*")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("created")])]),t._v(" "),a("td",[t._v("Not needed*")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("beforeMount")])]),t._v(" "),a("td",[a("code",[t._v("onBeforeMount")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("mounted")])]),t._v(" "),a("td",[a("code",[t._v("onMounted")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("beforeUpdate")])]),t._v(" "),a("td",[a("code",[t._v("onBeforeUpdate")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("updated")])]),t._v(" "),a("td",[a("code",[t._v("onUpdated")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("beforeUnmount")])]),t._v(" "),a("td",[a("code",[t._v("onBeforeUnmount")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("unmounted")])]),t._v(" "),a("td",[a("code",[t._v("onUnmounted")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("errorCaptured")])]),t._v(" "),a("td",[a("code",[t._v("onErrorCaptured")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("renderTracked")])]),t._v(" "),a("td",[a("code",[t._v("onRenderTracked")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("renderTriggered")])]),t._v(" "),a("td",[a("code",[t._v("onRenderTriggered")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("activated")])]),t._v(" "),a("td",[a("code",[t._v("onActivated")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("deactivated")])]),t._v(" "),a("td",[a("code",[t._v("onDeactivated")])])])])]),t._v(" "),a("h3",{attrs:{id:"一些踩到的坑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一些踩到的坑"}},[t._v("#")]),t._v(" 一些踩到的坑")]),t._v(" "),a("p",[t._v("1、一开始用追求方便用"),a("code",[t._v("context.root")]),t._v("调用"),a("code",[t._v("$emit")]),t._v("方法的时候，虽然 vetur 有提示可以使用，但是实际根本就不会触发"),a("code",[t._v("$emit")])]),t._v(" "),a("p",[t._v("2、"),a("code",[t._v("getCurrentInstance")]),t._v("解构出来的值不要在"),a("code",[t._v("return")]),t._v("里面返回，否则会出错，详情可以看看这个"),a("a",{attrs:{href:"https://github.com/vuejs/composition-api/issues/693",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("3、因为"),a("code",[t._v("Vue2")]),t._v("和"),a("code",[t._v("Vue3")]),t._v("实现响应式的方式有点不同，所以"),a("code",[t._v("reactive")]),t._v("定义出来的变量会有那么点不一样，如果直接修改后，那么这个变量很有可能就不是响应式的了,最好还是使用"),a("code",[t._v("ref")]),t._v("来，详情可以看下这个"),a("a",{attrs:{href:"https://github.com/vuejs/composition-api/issues/705",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"reactive-1-2-3-vs-ref"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reactive-1-2-3-vs-ref"}},[t._v("#")]),t._v(" reactive([1,2,3]) VS ref([])")]),t._v(" "),a("p",[t._v("这个"),a("a",{attrs:{href:"https://github.com/vuejs/docs-next/issues/801#issuecomment-757587022",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue"),a("OutboundLink")],1),t._v("说的挺清晰的")]),t._v(" "),a("h2",{attrs:{id:"最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[t._v("#")]),t._v(" 最后")]),t._v(" "),a("p",[t._v("只能说非常期待 Vue conf 所说的 Q3 会发布的 2.7 版本了，在 2.6 使用组合式 API 总的来说问题不大，而且比"),a("code",[t._v("mixin")]),t._v("用起来更爽。")])])}),[],!1,null,null,null);s.default=e.exports}}]);